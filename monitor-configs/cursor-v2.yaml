###################################################################################
# Cursor Dashboard ç›‘æ§é…ç½® (Version 2.0)
###################################################################################
# ä¸šåŠ¡è¯´æ˜ï¼š
#   æœ¬é…ç½®ç”¨äºç›‘æ§ Cursor.com Dashboard çš„ API ä½¿ç”¨é‡
#   Cursor æ˜¯ä¸€æ¬¾ AI ä»£ç ç¼–è¾‘å™¨ï¼Œæä¾›ä¸¤ç§ä½¿ç”¨é¢åº¦ï¼š
#   1. Included-Request Usage: è®¢é˜…åŒ…å«çš„å…è´¹è¯·æ±‚é¢åº¦ï¼ˆå¦‚ 87/500ï¼‰
#   2. On-Demand Usage: æŒ‰éœ€ä»˜è´¹ä½¿ç”¨é¢åº¦ï¼ˆå¦‚ $1/$10ï¼‰
#
# ç›‘æ§ç›®çš„ï¼š
#   - è·Ÿè¸ªå…è´¹é¢åº¦ä½¿ç”¨æƒ…å†µï¼Œé¿å…è¶…é¢
#   - ç›‘æ§ä»˜è´¹ä½¿ç”¨é‡‘é¢ï¼Œæ§åˆ¶æˆæœ¬
#   - åŠæ—¶äº†è§£é¢åº¦é‡ç½®æ—¶é—´
#
# é¡µé¢ç‰¹å¾ï¼š
#   - URL: https://cursor.com/dashboard
#   - è®¤è¯è¦æ±‚ï¼šéœ€è¦ç™»å½•çŠ¶æ€ï¼ˆé€šè¿‡ Cookieï¼‰
#   - é¡µé¢æŠ€æœ¯æ ˆï¼šNext.js + React + TailwindCSS
#   - æ•°æ®æ›´æ–°é¢‘ç‡ï¼šå®æ—¶
#   - å…³é”®æŒ‡æ ‡ï¼šå…è´¹ä½¿ç”¨é‡ã€ä»˜è´¹ä½¿ç”¨é‡ã€é‡ç½®æ—¶é—´
###################################################################################

name: "Cursor"
site_id: "cursor"
url: "https://cursor.com/dashboard"
description: "ç›‘æ§ Cursor AI ç¼–è¾‘å™¨çš„ API ä½¿ç”¨é‡å’Œè´¹ç”¨"
icon_url: "https://cursor.com/favicon.ico"

# ä¸šåŠ¡é‡è¦æ€§é…ç½®
priority: "high"  # high/medium/low
alert_threshold:
  included_usage_percent: 80  # å½“å…è´¹é¢åº¦ä½¿ç”¨è¶…è¿‡ 80% æ—¶å‘Šè­¦
  ondemand_amount: 8.0  # å½“æŒ‰éœ€è´¹ç”¨è¶…è¿‡ $8 æ—¶å‘Šè­¦
  critical_ondemand_amount: 9.5  # å½“æŒ‰éœ€è´¹ç”¨è¶…è¿‡ $9.5 æ—¶ç´§æ€¥å‘Šè­¦

###################################################################################
# æµè§ˆå™¨ç¯å¢ƒé…ç½®
###################################################################################
browser_config:
  viewport:
    width: 1920
    height: 1080
  
  # User-Agentï¼šæ¨¡æ‹ŸçœŸå®çš„ macOS Chrome æµè§ˆå™¨
  user_agent: "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
  
  timeouts:
    navigation: 30000
    wait_for_selector: 15000
    screenshot: 5000

###################################################################################
# é¡µé¢è®¿é—®ä¸æ•°æ®æå–æ­¥éª¤
###################################################################################
steps:
  # ============================================================================
  # æ­¥éª¤ 1: å¯¼èˆªåˆ° Dashboard é¡µé¢
  # ============================================================================
  - step_id: "nav_to_dashboard"
    action: "navigate"
    url: "https://cursor.com/dashboard"
    
    # ä¸šåŠ¡è¯´æ˜ï¼š
    #   è®¿é—® Cursor çš„ Dashboard ä¸»é¡µ
    #   é»˜è®¤ä¼šæ˜¾ç¤º "Overview" æ ‡ç­¾é¡µï¼ŒåŒ…å«ä½¿ç”¨é‡ä¿¡æ¯
    
    config:
      wait_until: "networkidle"
      timeout: 30000
    
    validation:
      - type: "url_contains"
        value: "/dashboard"
        error_message: "é¡µé¢å¯¼èˆªå¤±è´¥ï¼šæœªèƒ½è·³è½¬åˆ° Dashboard"
      
      - type: "http_status"
        value: 200
        error_message: "HTTP è¯·æ±‚å¤±è´¥"

  # ============================================================================
  # æ­¥éª¤ 2: éªŒè¯ç™»å½•çŠ¶æ€
  # ============================================================================
  - step_id: "verify_login"
    action: "wait_for_element"
    
    # ä¸šåŠ¡è¯´æ˜ï¼š
    #   éªŒè¯ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
    #   Cursor çš„å·²ç™»å½•æ ‡å¿—ï¼š
    #   - ä¾§è¾¹æ æ˜¾ç¤ºç”¨æˆ·åå’Œé‚®ç®±
    #   - "Overview" å¯¼èˆªé¡¹å¤„äºé€‰ä¸­çŠ¶æ€
    #   - å­˜åœ¨ç”¨æˆ·å¤´åƒ
    
    # é¡µé¢ç»“æ„åˆ†æï¼ˆåŸºäºå®é™… HTMLï¼‰ï¼š
    #   - ä¾§è¾¹æ åŒ…å«ç”¨æˆ·ä¿¡æ¯ï¼šclass="flex flex-col gap-2 min-w-0"
    #   - ç”¨æˆ·åæ˜¾ç¤ºï¼štitle="Zicdasf Zhang"
    #   - é‚®ç®±æ˜¾ç¤ºï¼šåŒ…å« "@gmail.com" ç­‰
    #   - Overview æ ‡ç­¾å¤„äºæ¿€æ´»çŠ¶æ€ï¼šclass="bg-brand-dashboard-card text-white"
    
    selectors:
      # ä¸»é€‰æ‹©å™¨ï¼šOverview å¯¼èˆªé¡¹ï¼ˆå·²é€‰ä¸­çŠ¶æ€ï¼‰
      primary: "a[title='Overview'].bg-brand-dashboard-card"
      
      # å¤‡ç”¨é€‰æ‹©å™¨ï¼š
      fallback:
        - "a[href*='/dashboard'][title*='Overview']"  # Overview é“¾æ¥
        - "[data-testid='user-menu']"  # ç”¨æˆ·èœå•
        - "button[aria-label*='User menu']"  # ç”¨æˆ·èœå•æŒ‰é’®
    
    config:
      timeout: 15000
      visible: true
    
    on_failure:
      action: "abort"
      reason: "cookie_expired"
      message: "ç™»å½•çŠ¶æ€éªŒè¯å¤±è´¥ï¼šCookie å¯èƒ½å·²è¿‡æœŸ"

  # ============================================================================
  # æ­¥éª¤ 3: ç­‰å¾…ä½¿ç”¨é‡å¡ç‰‡åŠ è½½
  # ============================================================================
  - step_id: "wait_for_usage_card"
    action: "wait_for_element"
    
    # ä¸šåŠ¡è¯´æ˜ï¼š
    #   ç­‰å¾…ä½¿ç”¨é‡å¡ç‰‡å®Œå…¨åŠ è½½
    #   å¡ç‰‡åŒ…å«ä¸¤ä¸ªä¸»è¦æŒ‡æ ‡ï¼š
    #   1. Included-Request Usage ï¼ˆå·¦ä¾§ï¼‰
    #   2. On-Demand Usage ï¼ˆå³ä¾§ï¼‰
    
    # é¡µé¢ç»“æ„åˆ†æï¼ˆåŸºäºå®é™… HTMLï¼‰ï¼š
    #   <div class="rounded-lg p-4">  â† ä½¿ç”¨é‡å¡ç‰‡å®¹å™¨
    #     <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">  â† ç½‘æ ¼å¸ƒå±€
    #       <div class="flex flex-col gap-4 p-2">  â† å·¦ä¾§ï¼šIncluded Usage
    #         <div class="flex w-full min-w-0 flex-col gap-2">
    #           <div class="flex w-full min-w-0 items-baseline gap-1.5 overflow-hidden">
    #             <div class="web-text-xl flex-shrink-0 font-medium">87</div>  â† å·²ä½¿ç”¨
    #             <div class="web-text-xl dashboard-text-tertiary truncate font-medium">/ 500</div>  â† æ€»é¢åº¦
    #           </div>
    #           <div class="web-text-base dashboard-text-secondary font-medium">Included-Request Usage</div>  â† æ ‡é¢˜
    #         </div>
    #       </div>
    #       <div class="flex flex-col gap-4">  â† å³ä¾§ï¼šOn-Demand Usage
    #         <div class="rounded-xl bg-brand-dashboard-card">
    #           <div class="flex w-full min-w-0 items-baseline gap-1 overflow-hidden">
    #             <div class="text-base font-medium">$1</div>  â† å·²ä½¿ç”¨é‡‘é¢
    #             <div class="dashboard-text-secondary truncate text-base font-medium">/ $10</div>  â† é™é¢
    #           </div>
    #           <div class="web-text-base dashboard-text-secondary mt-2 min-h-[32px]">On-Demand Usage this Month</div>  â† æ ‡é¢˜
    #         </div>
    #       </div>
    #     </div>
    #   </div>
    
    selectors:
      # ä¸»é€‰æ‹©å™¨ï¼šä½¿ç”¨é‡å¡ç‰‡å®¹å™¨
      primary: "div.rounded-lg.p-4[style*='background']"
      
      # æ›´å…·ä½“çš„é€‰æ‹©å™¨ï¼šåŒ…å«ä½¿ç”¨é‡æ ‡é¢˜çš„å…ƒç´ 
      fallback:
        - "div:has-text('Included-Request Usage')"
        - "div:has-text('On-Demand Usage')"
        - ".grid.grid-cols-1.gap-6.lg\\:grid-cols-2"  # ç½‘æ ¼å¸ƒå±€å®¹å™¨
    
    config:
      timeout: 15000
      visible: true

  # ============================================================================
  # æ­¥éª¤ 4: æå– Included-Request ä½¿ç”¨é‡ï¼ˆ87/500ï¼‰
  # ============================================================================
  - step_id: "extract_included_usage"
    action: "extract"
    
    # ä¸šåŠ¡è¯´æ˜ï¼š
    #   æå– Included-Request çš„ä½¿ç”¨æƒ…å†µ
    #   éœ€è¦æå–ä¸¤ä¸ªæ•°å€¼ï¼š
    #   - used: å·²ä½¿ç”¨æ•°é‡ï¼ˆå¦‚ 87ï¼‰
    #   - total: æ€»é¢åº¦ï¼ˆå¦‚ 500ï¼‰
    
    # æå–ç­–ç•¥ï¼š
    #   æ–¹æ¡ˆ 1ï¼šåˆ†åˆ«æå–ä¸¤ä¸ªæ•°å­—ï¼ˆæ¨èï¼‰
    #   æ–¹æ¡ˆ 2ï¼šæå–å®Œæ•´å­—ç¬¦ä¸²åæ‹†åˆ†
    
    target:
      # æå–å·²ä½¿ç”¨æ•°é‡
      - field_name: "included_used"
        field_type: "integer"
        field_description: "Included-Request å·²ä½¿ç”¨æ•°é‡"
      
      # æå–æ€»é¢åº¦
      - field_name: "included_total"
        field_type: "integer"
        field_description: "Included-Request æ€»é¢åº¦"
    
    extraction:
      # æå–æ–¹æ³• 1ï¼šæå–å·²ä½¿ç”¨æ•°é‡
      - target_field: "included_used"
        method: "text"
        
        # é€‰æ‹©å™¨ï¼šç²¾ç¡®å®šä½åˆ°å·²ä½¿ç”¨æ•°é‡çš„å…ƒç´ 
        # ç‰¹å¾ï¼š
        #   - class="web-text-xl flex-shrink-0 font-medium"
        #   - åœ¨ "Included-Request Usage" æ ‡é¢˜ä¹‹å‰
        #   - åœ¨ "/ 500" ä¹‹å‰
        selector: "div:has(div:has-text('Included-Request Usage')) .web-text-xl.flex-shrink-0.font-medium:first"
        
        # å¤‡ç”¨é€‰æ‹©å™¨ï¼šé€šè¿‡æ–‡æœ¬åŒ¹é…
        fallback_selector: |
          div:has-text('Included-Request Usage')
          >> xpath=ancestor::div[contains(@class, 'flex-col')]//div[contains(@class, 'web-text-xl')][1]
        
        # æ•°æ®æ¸…æ´—ï¼š
        #   ç§»é™¤å¯èƒ½çš„ç©ºæ ¼ã€é€—å·ç­‰
        clean: true
        
        # æ•°æ®è½¬æ¢ï¼šè½¬æ¢ä¸ºæ•´æ•°
        transform: "integer"
        
        # æ•°æ®éªŒè¯ï¼š
        validation:
          min_value: 0
          max_value: 1000  # Included é¢åº¦é€šå¸¸ä¸è¶…è¿‡ 1000
      
      # æå–æ–¹æ³• 2ï¼šæå–æ€»é¢åº¦
      - target_field: "included_total"
        method: "text"
        
        # é€‰æ‹©å™¨ï¼šç²¾ç¡®å®šä½åˆ°æ€»é¢åº¦çš„å…ƒç´ 
        # ç‰¹å¾ï¼š
        #   - åŒ…å« "/ " å‰ç¼€
        #   - class="web-text-xl dashboard-text-tertiary truncate font-medium"
        selector: "div:has(div:has-text('Included-Request Usage')) .web-text-xl.dashboard-text-tertiary"
        
        # æ­£åˆ™æå–ï¼šä» "/ 500" ä¸­æå– "500"
        regex: "\\/\\s*(\\d+)"
        regex_group: 1
        
        # æ•°æ®è½¬æ¢
        transform: "integer"
        
        validation:
          min_value: 100  # æ€»é¢åº¦è‡³å°‘ 100
          max_value: 1000

  # ============================================================================
  # æ­¥éª¤ 5: æå– On-Demand ä½¿ç”¨é‡‘é¢ï¼ˆ$1/$10ï¼‰
  # ============================================================================
  - step_id: "extract_ondemand_usage"
    action: "extract"
    
    # ä¸šåŠ¡è¯´æ˜ï¼š
    #   æå– On-Demand çš„ä½¿ç”¨æƒ…å†µ
    #   éœ€è¦æå–ä¸¤ä¸ªé‡‘é¢ï¼š
    #   - used_amount: å·²ä½¿ç”¨é‡‘é¢ï¼ˆå¦‚ $1ï¼‰
    #   - limit_amount: é™é¢ï¼ˆå¦‚ $10ï¼‰
    
    target:
      - field_name: "ondemand_used"
        field_type: "currency"
        field_description: "On-Demand å·²ä½¿ç”¨é‡‘é¢"
      
      - field_name: "ondemand_limit"
        field_type: "currency"
        field_description: "On-Demand æœˆåº¦é™é¢"
    
    extraction:
      # æå–æ–¹æ³• 1ï¼šæå–å·²ä½¿ç”¨é‡‘é¢
      - target_field: "ondemand_used"
        method: "text"
        
        # é€‰æ‹©å™¨ï¼šç²¾ç¡®å®šä½åˆ° On-Demand å¡ç‰‡ä¸­çš„å·²ä½¿ç”¨é‡‘é¢
        # ç‰¹å¾ï¼š
        #   - åœ¨ "On-Demand Usage this Month" æ ‡é¢˜ä¹‹å‰
        #   - class="text-base font-medium"
        #   - ä¸åŒ…å« "dashboard-text-secondary" class
        selector: |
          div:has-text('On-Demand Usage this Month')
          >> xpath=ancestor::div[contains(@class, 'rounded-xl')]//div[contains(@class, 'text-base') and contains(@class, 'font-medium') and not(contains(@class, 'dashboard-text-secondary'))]
        
        # å¤‡ç”¨é€‰æ‹©å™¨ï¼š
        fallback_selector: ".bg-brand-dashboard-card .text-base.font-medium:not(.dashboard-text-secondary):first"
        
        # æ­£åˆ™æå–ï¼šä» "$1" ä¸­æå– "1"
        regex: "\\$?\\s*(\\d+(?:\\.\\d+)?)"
        regex_group: 1
        
        # æ•°æ®è½¬æ¢ï¼šè½¬æ¢ä¸ºæµ®ç‚¹æ•°
        transform: "float"
        
        validation:
          min_value: 0.0
          max_value: 100.0  # On-Demand å•æœˆé€šå¸¸ä¸è¶…è¿‡ $100
      
      # æå–æ–¹æ³• 2ï¼šæå–é™é¢
      - target_field: "ondemand_limit"
        method: "text"
        
        # é€‰æ‹©å™¨ï¼šç²¾ç¡®å®šä½åˆ°é™é¢å…ƒç´ 
        # ç‰¹å¾ï¼š
        #   - åŒ…å« "/ $" å‰ç¼€
        #   - class="dashboard-text-secondary"
        selector: |
          div:has-text('On-Demand Usage this Month')
          >> xpath=ancestor::div[contains(@class, 'rounded-xl')]//div[contains(@class, 'dashboard-text-secondary') and contains(text(), '/')]
        
        # æ­£åˆ™æå–ï¼šä» "/ $10" ä¸­æå– "10"
        regex: "\\/\\s*\\$?\\s*(\\d+(?:\\.\\d+)?)"
        regex_group: 1
        
        transform: "float"
        
        validation:
          min_value: 5.0  # é™é¢è‡³å°‘ $5
          max_value: 100.0

  # ============================================================================
  # æ­¥éª¤ 6: æå–é‡ç½®æ—¶é—´ï¼ˆå¯é€‰ï¼‰
  # ============================================================================
  - step_id: "extract_reset_time"
    action: "extract"
    optional: true  # å¯é€‰æ­¥éª¤
    
    # ä¸šåŠ¡è¯´æ˜ï¼š
    #   æå– Included-Request çš„é‡ç½®æ—¶é—´
    #   ç”¨äºåˆ¤æ–­ä½•æ—¶é¢åº¦ä¼šé‡ç½®
    
    # é¡µé¢ç»“æ„åˆ†æï¼š
    #   <div class="web-text-sm dashboard-text-tertiary">
    #     Usage included in your plan.<br>
    #     <div class="flex items-center gap-1">
    #       Resets Dec 4, 2025  â† é‡ç½®æ—¶é—´
    #       <svg>...</svg>
    #     </div>
    #   </div>
    
    target:
      field_name: "reset_date"
      field_type: "date"
      field_description: "Included-Request é¢åº¦é‡ç½®æ—¥æœŸ"
    
    extraction:
      - method: "text"
        
        # é€‰æ‹©å™¨ï¼šåŒ…å« "Resets" æ–‡æœ¬çš„å…ƒç´ 
        selector: "div:has-text('Resets')"
        
        # æ­£åˆ™æå–ï¼šä» "Resets Dec 4, 2025" ä¸­æå–æ—¥æœŸ
        # æ”¯æŒå¤šç§æ—¥æœŸæ ¼å¼ï¼š
        #   - Dec 4, 2025
        #   - 2025-12-04
        #   - 12/04/2025
        regex: "Resets\\s+([A-Za-z]+\\s+\\d+,\\s+\\d+|\\d{4}-\\d{2}-\\d{2}|\\d{2}/\\d{2}/\\d{4})"
        regex_group: 1
        
        # æ—¥æœŸè§£æ
        transform: "date"
        date_format: "MMM D, YYYY"  # ç¤ºä¾‹ï¼šDec 4, 2025
        
        # å¦‚æœæå–å¤±è´¥ï¼Œä¸å½±å“æ•´ä½“æµç¨‹
        on_failure: "skip"

  # ============================================================================
  # æ­¥éª¤ 7: æˆªå–é¡µé¢æˆªå›¾
  # ============================================================================
  - step_id: "capture_screenshot"
    action: "screenshot"
    
    config:
      type: "viewport"
      quality: 85
      format: "png"
      
      # æˆªå›¾å‰çš„å‡†å¤‡ï¼š
      before_screenshot:
        # éšè—ä¸å¿…è¦çš„å…ƒç´ 
        hide_elements:
          - "[role='dialog']"  # å¼¹çª—
          - ".notification"  # é€šçŸ¥
          - "[data-tooltip-id]"  # Tooltipï¼ˆé¿å…é®æŒ¡ï¼‰
        
        # æ»šåŠ¨åˆ°ä½¿ç”¨é‡å¡ç‰‡
        scroll_to: "div:has-text('Included-Request Usage')"
        scroll_behavior: "smooth"
    
    storage:
      bucket: "monitor-screenshots"
      path_template: "{site_id}/{date}/{step_id}.{format}"
      overwrite: true
      access_level: "authenticated"
    
    on_success:
      add_url_to_data: true
      url_field: "screenshot_url"

###################################################################################
# Cookie éªŒè¯é…ç½®
###################################################################################
cookie_validation:
  logged_in_indicators:
    - selector: "a[title='Overview']"
      should_exist: true
      description: "Overview å¯¼èˆªé¡¹å­˜åœ¨"
    
    - selector: "div:has-text('Included-Request Usage')"
      should_exist: true
      description: "ä½¿ç”¨é‡å¡ç‰‡å­˜åœ¨"
    
    - selector: "button[aria-label*='User menu'], [data-testid='user-menu']"
      should_exist: true
      description: "ç”¨æˆ·èœå•å­˜åœ¨"
  
  logged_out_indicators:
    - selector: "button:has-text('Sign In'), a:has-text('Sign In')"
      should_exist: true
      description: "å‡ºç°ç™»å½•æŒ‰é’®"
    
    - selector: "a[href*='/login']"
      should_exist: true
      description: "å‡ºç°ç™»å½•é“¾æ¥"
  
  timeout: 10000
  
  on_invalid:
    action: "abort"
    reason: "cookie_expired"
    message: "Cookie éªŒè¯å¤±è´¥ï¼Œè¯·æ›´æ–°è®¤è¯ä¿¡æ¯"
    notify: true
    notification_channels: ["email", "webhook"]

###################################################################################
# æ•°æ®å¤„ç†ä¸å­˜å‚¨é…ç½®
###################################################################################
data_processing:
  # æ•°æ®æ¸…æ´—ï¼š
  cleaning_rules:
    - fields: ["ondemand_used", "ondemand_limit"]
      remove_chars: ["$", ",", " "]
      round_to: 2
  
  # æ•°æ®éªŒè¯ï¼š
  validation_rules:
    - field: "included_used"
      rules:
        - type: "not_null"
        - type: "numeric"
        - type: "integer"
        - type: "range"
          min: 0
          max: 1000
    
    - field: "ondemand_used"
      rules:
        - type: "not_null"
        - type: "numeric"
        - type: "range"
          min: 0.0
          max: 100.0
  
  # æ•°æ®å¢å¼ºï¼š
  enrichment:
    # è®¡ç®— Included-Request ä½¿ç”¨ç™¾åˆ†æ¯”
    - field: "included_usage_percent"
      formula: "(included_used / included_total) * 100"
      round_to: 1
    
    # è®¡ç®— On-Demand ä½¿ç”¨ç™¾åˆ†æ¯”
    - field: "ondemand_usage_percent"
      formula: "(ondemand_used / ondemand_limit) * 100"
      round_to: 1
    
    # è®¡ç®—å‰©ä½™å…è´¹é¢åº¦
    - field: "included_remaining"
      formula: "included_total - included_used"
    
    # è®¡ç®—å‰©ä½™ä»˜è´¹é¢åº¦
    - field: "ondemand_remaining"
      formula: "ondemand_limit - ondemand_used"
      format: "$%.2f"
    
    # ç»¼åˆçŠ¶æ€è¯„ä¼°
    - field: "usage_status"
      formula: |
        if included_usage_percent >= 90:
          return "critical"
        elif included_usage_percent >= 80:
          return "warning"
        elif ondemand_usage_percent >= 90:
          return "critical"
        elif ondemand_usage_percent >= 80:
          return "warning"
        else:
          return "normal"
    
    # æ ¼å¼åŒ–æ˜¾ç¤º
    - field: "summary"
      formula: |
        return {
          "included": f"{included_used}/{included_total} ({included_usage_percent}%)",
          "ondemand": f"${ondemand_used}/${ondemand_limit} ({ondemand_usage_percent}%)",
          "status": usage_status
        }

storage_config:
  table: "keep_monitor_records"
  field_mapping:
    included_used: "data->included_used"
    included_total: "data->included_total"
    included_usage_percent: "data->included_usage_percent"
    included_remaining: "data->included_remaining"
    ondemand_used: "data->ondemand_used"
    ondemand_limit: "data->ondemand_limit"
    ondemand_usage_percent: "data->ondemand_usage_percent"
    ondemand_remaining: "data->ondemand_remaining"
    usage_status: "data->usage_status"
    reset_date: "data->reset_date"
    summary: "data->summary"
    screenshot_url: "screenshot_url"
  on_conflict: "replace"

###################################################################################
# é”™è¯¯å¤„ç†ä¸é‡è¯•ç­–ç•¥
###################################################################################
error_handling:
  global_retry:
    max_attempts: 3
    backoff_strategy: "exponential"
    initial_delay: 1000
    max_delay: 30000
  
  specific_errors:
    - error_type: "TimeoutError"
      action: "retry"
      max_retries: 5
    
    - error_type: "AuthenticationError"
      action: "abort"
      notify: true
    
    - error_type: "ElementNotFoundError"
      action: "retry"
      max_retries: 3
    
    - error_type: "ExtractionError"
      action: "abort"
      notify: true
  
  logging:
    level: "info"
    include_screenshot: true
    include_html: true

###################################################################################
# ç›‘æ§ä¸å‘Šè­¦é…ç½®
###################################################################################
monitoring:
  collect_metrics: true
  metrics:
    - page_load_time
    - total_execution_time
    - screenshot_time
    - extraction_time
  
  alerts:
    # Included-Request é¢åº¦å‘Šè­¦
    - name: "included_usage_high_alert"
      condition: "included_usage_percent >= 80"
      severity: "warning"
      message: "âš ï¸ Cursor Included-Request ä½¿ç”¨ç‡å·²è¾¾ ${included_usage_percent}%ï¼ˆ${included_used}/${included_total}ï¼‰"
      channels: ["email", "webhook"]
    
    - name: "included_usage_critical_alert"
      condition: "included_usage_percent >= 90"
      severity: "critical"
      message: "ğŸš¨ Cursor Included-Request ä½¿ç”¨ç‡å·²è¾¾ ${included_usage_percent}%ï¼ˆ${included_used}/${included_total}ï¼‰ï¼Œæ¥è¿‘ä¸Šé™ï¼"
      channels: ["email", "webhook", "sms"]
    
    # On-Demand è´¹ç”¨å‘Šè­¦
    - name: "ondemand_usage_high_alert"
      condition: "ondemand_used >= 8.0"
      severity: "warning"
      message: "âš ï¸ Cursor On-Demand è´¹ç”¨å·²è¾¾ $${ondemand_used}ï¼ˆé™é¢ $${ondemand_limit}ï¼‰"
      channels: ["email", "webhook"]
    
    - name: "ondemand_usage_critical_alert"
      condition: "ondemand_used >= 9.5"
      severity: "critical"
      message: "ğŸš¨ Cursor On-Demand è´¹ç”¨å·²è¾¾ $${ondemand_used}ï¼ˆé™é¢ $${ondemand_limit}ï¼‰ï¼Œå³å°†è¾¾åˆ°ä¸Šé™ï¼"
      channels: ["email", "webhook", "sms"]
    
    # é‡‡é›†å¤±è´¥å‘Šè­¦
    - name: "collection_failed_alert"
      condition: "status == 'failed'"
      severity: "error"
      message: "âŒ Cursor æ•°æ®é‡‡é›†å¤±è´¥ï¼š${error_message}"
      channels: ["email", "webhook"]

###################################################################################
# è°ƒè¯•é…ç½®
###################################################################################
debug:
  enabled: false
  options:
    verbose_logging: true
    save_html: true
    html_path: "./debug/cursor_{timestamp}.html"
    save_full_screenshot: true
    screenshot_path: "./debug/cursor_{timestamp}.png"
    pause_on_error: false
    pause_duration: 30000
    headless: false

###################################################################################
# ç‰ˆæœ¬ä¿¡æ¯
###################################################################################
version: "2.0.0"
last_updated: "2025-11-11"
author: "AI Assistant"
changelog:
  - version: "2.0.0"
    date: "2025-11-11"
    changes:
      - "å®Œå…¨é‡æ„é…ç½®æ–‡ä»¶ï¼Œå¢åŠ è¯¦ç»†æ³¨é‡Š"
      - "åŸºäºå®é™…é¡µé¢HTMLç»“æ„ä¼˜åŒ–é€‰æ‹©å™¨"
      - "åŒæ—¶æå– Included-Request å’Œ On-Demand ä¸¤ä¸ªæŒ‡æ ‡"
      - "æ·»åŠ ä½¿ç”¨ç™¾åˆ†æ¯”è®¡ç®—å’ŒçŠ¶æ€è¯„ä¼°"
      - "æ·»åŠ å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œå‘Šè­¦æœºåˆ¶"
  
  - version: "1.0.0"
    date: "2025-11-10"
    changes:
      - "åˆå§‹ç‰ˆæœ¬"

