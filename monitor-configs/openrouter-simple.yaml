name: "OpenRouter"
site_id: "openrouter"
url: "https://openrouter.ai/settings/credits"
description: "监控 OpenRouter API Credits 余额 (简化版)"
icon_url: "https://openrouter.ai/favicon.ico"

steps:
  # 1. 导航到 Credits 页面
  # 使用 networkidle0 确保所有网络请求完成，包括 Clerk SDK 的 Token 刷新请求
  - action: "navigate"
    url: "https://openrouter.ai/settings/credits"
    wait_for: "networkidle0"
    timeout: 45000
    comment: "访问 OpenRouter Credits 页面，等待所有网络请求完成（包括 Token 刷新）"

  # 2. 等待 Clerk SDK 自动刷新 Session Token
  # Session Token 只有 1 分钟有效期，但 Refresh Token 有效（364天）
  # Clerk SDK 会自动用 Refresh Token 获取新的 Session Token
  - action: "wait"
    selector: "body"
    timeout: 5000
    comment: "等待 Clerk SDK 完成 Session Token 自动刷新（Refresh Token 机制）"

  # 3. 额外等待，确保页面完全加载和 React 渲染
  - action: "wait"
    selector: "body"
    timeout: 3000
    comment: "等待 React 组件完全渲染"

  # 4. 调试截图 - 验证是否成功登录
  - action: "screenshot"
    full_page: true
    comment: "调试截图 - 验证 Refresh Token 是否成功刷新 Session Token"

  # 5. 提取 Credits 余额
  # 目标 div: <div class="group/card rounded-xl..." aria-label="Remaining credits: 7.725">
  # 直接从 aria-label 属性提取数值，避免处理内部复杂的数字动画
  - action: "extract"
    name: "credits"
    selector: "div[aria-label*='Remaining credits']"
    extract_type: "attribute"
    attribute: "aria-label"
    regex_pattern: "Remaining credits:\\s*([\\d.]+)"
    regex_group: 1
    transform: "float"
    comment: "从 aria-label 属性中提取 Credits 余额"

  # 6. 截图
  - action: "screenshot"
    full_page: false
    comment: "截取页面"

# Cookie 验证配置
validation:
  cookie_check:
    selector: "div[aria-label*='Remaining']"
    should_exist: true

