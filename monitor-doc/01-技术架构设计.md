# KeepUp è´¹ç”¨ç›‘æ§ç³»ç»Ÿ - æŠ€æœ¯æ¶æ„è®¾è®¡

## ğŸ“ æ¶æ„æ€»è§ˆ

### ç³»ç»Ÿç»„æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ (Vue 3) - /monitor                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ MonitorCard â”‚  â”‚ MonitorCard â”‚  â”‚ MonitorCard  â”‚ â”‚
â”‚  â”‚ (OpenRouter)â”‚  â”‚  (TikHub)   â”‚  â”‚  (Cursor)    â”‚ â”‚
â”‚  â”‚   æ‰‹åŠ¨è§¦å‘   â”‚  â”‚   æ‰‹åŠ¨è§¦å‘   â”‚  â”‚   æ‰‹åŠ¨è§¦å‘   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚ å•ä¸ªè§¦å‘        â”‚                â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                â”‚
          â†“                 â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase Edge Functions (Deno + Puppeteer)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  scrape-site     â”‚  â”‚  scrape-all      â”‚         â”‚
â”‚  â”‚  (é€šç”¨æŠ“å–å™¨)     â”‚  â”‚  (æ‰¹é‡è§¦å‘å™¨)     â”‚         â”‚
â”‚  â”‚  - è¯»å–é…ç½®       â”‚  â”‚  - è°ƒç”¨å¤šä¸ªsite  â”‚         â”‚
â”‚  â”‚  - æ‰§è¡Œæ­¥éª¤       â”‚  â”‚  - å¹¶è¡Œæ‰§è¡Œ       â”‚         â”‚
â”‚  â”‚  - ä¿å­˜æ•°æ®       â”‚  â”‚                  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚
         â†“                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase Database  â”‚  â”‚  Supabase Storage         â”‚
â”‚  â”œâ”€ sites           â”‚  â”‚  monitor-screenshots/     â”‚
â”‚  â”œâ”€ cookies         â”‚  â”‚  â”œâ”€ openrouter/latest.png â”‚
â”‚  â””â”€ records         â”‚  â”‚  â”œâ”€ tikhub/latest.png     â”‚
â”‚                     â”‚  â”‚  â””â”€ cursor/latest.png     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
         â”‚ å®šæ—¶è§¦å‘ (æ¯å¤©9ç‚¹)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vercel Cron Job (0 1 * * *)                        â”‚
â”‚  â””â†’ è°ƒç”¨ Supabase Edge Function: scrape-all         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ åŠŸèƒ½å¤ç”¨è®¾è®¡

### æ ¸å¿ƒåŸåˆ™ï¼šä¸€ä¸ªEdge Functionå¤„ç†æ‰€æœ‰åœºæ™¯

**scrape-site Edge Function** åŒæ—¶æ”¯æŒï¼š
1. **æ‰‹åŠ¨è§¦å‘**ï¼šå‰ç«¯å¡ç‰‡ç‚¹å‡» â†’ å•ä¸ªç½‘ç«™æŠ“å–
2. **è‡ªåŠ¨è§¦å‘**ï¼šVercel Cron â†’ scrape-all â†’ è°ƒç”¨å¤šä¸ªscrape-site

```typescript
// Edge Function: scrape-site
// å‚æ•°: { site_slug: 'openrouter', validate_only?: false }

export async function scrapeSite(site_slug: string, validate_only = false) {
  // 1. è¯»å–ç½‘ç«™é…ç½®å’ŒCookie
  // 2. æ‰§è¡ŒPuppeteeræ“ä½œ
  // 3. å¦‚æœvalidate_only=trueï¼ŒåªéªŒè¯Cookieï¼Œä¸æŠ“æ•°æ®
  // 4. ä¿å­˜ç»“æœåˆ°æ•°æ®åº“
  // 5. ä¸Šä¼ æˆªå›¾åˆ°Storage
}
```

### validate_cookiesåŠŸèƒ½æ•´åˆ

**CookieéªŒè¯å’Œæ•°æ®æŠ“å–æ˜¯åŒä¸€ä¸ªæµç¨‹ï¼š**

- è®¿é—®é¡µé¢æ—¶è‡ªåŠ¨æ£€æµ‹Cookieæœ‰æ•ˆæ€§
- å¦‚æœCookieå¤±æ•ˆï¼Œä¼šè¿”å›ç™»å½•é¡µé¢æˆ–401é”™è¯¯
- åœ¨scraper_configçš„`validation`é…ç½®ä¸­å®šä¹‰æ£€æµ‹è§„åˆ™

```yaml
validation:
  # Cookieæœ‰æ•ˆæ€§æ£€æµ‹ï¼šæ£€æŸ¥æ˜¯å¦æœ‰"é€€å‡ºç™»å½•"æŒ‰é’®
  cookie_check:
    selector: 'button:has-text("Sign Out")'
    # å¦‚æœæ‰¾åˆ°æ­¤å…ƒç´ ï¼Œè¯´æ˜å·²ç™»å½•ï¼ŒCookieæœ‰æ•ˆ
```

## ğŸ¨ è§†è§‰è®¾è®¡ - Glassmorphism (2025è¶‹åŠ¿)

### è®¾è®¡åŸåˆ™

1. **ç£¨ç ‚ç»ç’ƒèƒŒæ™¯**ï¼šbackdrop-filter + blur
2. **åŠé€æ˜å±‚**ï¼šrgbaé¢œè‰²ï¼Œé€æ˜åº¦80-95%
3. **ç»†è¾¹æ¡†**ï¼š1pxç™½è‰²/é»‘è‰²ï¼Œé€æ˜åº¦10-20%
4. **å¾®å¦™é˜´å½±**ï¼šå¤šå±‚box-shadow
5. **æµåŠ¨æ¸å˜**ï¼šèƒŒæ™¯åŠ¨æ€æ¸å˜åŠ¨ç”»

### æ ¸å¿ƒCSSæ ·å¼

```css
.monitor-card {
  /* ç£¨ç ‚ç»ç’ƒæ•ˆæœ */
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px) saturate(180%);
  
  /* è¾¹æ¡† */
  border: 1px solid rgba(255, 255, 255, 0.18);
  border-radius: 24px;
  
  /* é˜´å½± */
  box-shadow: 
    0 8px 32px 0 rgba(0, 0, 0, 0.1),
    inset 0 1px 0 0 rgba(255, 255, 255, 0.2);
  
  /* è¿‡æ¸¡åŠ¨ç”» */
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.monitor-card:hover {
  background: rgba(255, 255, 255, 0.12);
  transform: translateY(-4px);
  box-shadow: 
    0 16px 48px 0 rgba(0, 0, 0, 0.15),
    inset 0 1px 0 0 rgba(255, 255, 255, 0.3);
}

/* CookieçŠ¶æ€æŒ‡ç¤ºå™¨ */
.cookie-status {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: rgba(52, 211, 153, 0.9); /* ç»¿è‰² */
  box-shadow: 
    0 0 10px rgba(52, 211, 153, 0.5),
    0 0 20px rgba(52, 211, 153, 0.3);
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

.cookie-status.invalid {
  background: rgba(248, 113, 113, 0.9); /* çº¢è‰² */
  box-shadow: 
    0 0 10px rgba(248, 113, 113, 0.5),
    0 0 20px rgba(248, 113, 113, 0.3);
}

/* èƒŒæ™¯æ¸å˜åŠ¨ç”» */
@keyframes gradient {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

.monitor-view {
  background: linear-gradient(
    -45deg,
    rgba(139, 92, 246, 0.05),
    rgba(59, 130, 246, 0.05),
    rgba(16, 185, 129, 0.05),
    rgba(236, 72, 153, 0.05)
  );
  background-size: 400% 400%;
  animation: gradient 15s ease infinite;
}
```

## ğŸ”§ API Routeåè°ƒå™¨è¯´æ˜

### API Routeçš„ä½œç”¨

**API Route (`/api/cron/scrape-monitor.ts`) ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†å¼ºçƒˆæ¨èä½¿ç”¨ã€‚**

### ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ

1. **Vercel Cronåªèƒ½è°ƒç”¨è‡ªå·±é¡¹ç›®çš„API endpoint**
   - Cronæ— æ³•ç›´æ¥è°ƒç”¨å¤–éƒ¨URLï¼ˆSupabaseï¼‰
   - éœ€è¦ä¸€ä¸ªä¸­é—´å±‚æ¥è½¬å‘è¯·æ±‚

2. **å®‰å…¨éªŒè¯**
   - éªŒè¯è¯·æ±‚æ¥è‡ªVercel Cronï¼ˆé€šè¿‡Authorization headerï¼‰
   - é˜²æ­¢æœªæˆæƒè®¿é—®

3. **é”™è¯¯å¤„ç†å’Œæ—¥å¿—**
   - è®°å½•æ‰§è¡Œæ—¥å¿—
   - å¤„ç†å¤±è´¥é‡è¯•

### å·¥ä½œæµç¨‹

```
Vercel Cron (æ¯å¤©9ç‚¹)
  â†“ è°ƒç”¨è‡ªå·±çš„API
/api/cron/scrape-monitor
  â†“ éªŒè¯CRON_SECRET
  â†“ è½¬å‘è¯·æ±‚
Supabase Edge Function: scrape-all
  â†“ å¹¶è¡Œè°ƒç”¨
scrape-site (openrouter)
scrape-site (tikhub)
scrape-site (cursor)
```

### ä»£ç ç¤ºä¾‹

```typescript
// api/cron/scrape-monitor.ts
export default async function handler(req: Request, res: Response) {
  // 1. éªŒè¯æ¥è‡ªVercel Cron
  const authHeader = req.headers.authorization || '';
  if (authHeader !== `Bearer ${process.env.CRON_SECRET}`) {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  // 2. è°ƒç”¨Supabase Edge Function
  const response = await fetch(
    `${process.env.VITE_SUPABASE_URL}/functions/v1/scrape-all`,
    {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${process.env.SUPABASE_SERVICE_ROLE_KEY}`,
        'Content-Type': 'application/json'
      }
    }
  );
  
  // 3. è¿”å›ç»“æœ
  const data = await response.json();
  return res.status(200).json(data);
}
```

### æ˜¯å¦å¿…é¡»ï¼Ÿ

- **æœ‰API Route**ï¼šVercel Cron â†’ API Route â†’ Supabaseï¼ˆæ¨èï¼‰
- **æ— API Route**ï¼šéœ€è¦ä½¿ç”¨GitHub Actionsæˆ–å…¶ä»–å®šæ—¶ä»»åŠ¡æœåŠ¡

**ç»“è®ºï¼šåœ¨Vercelç¯å¢ƒä¸‹æ˜¯å¿…é¡»çš„ã€‚**

## ğŸ“¦ Supabase Storageè®¿é—®

### åˆ›å»ºBucketåçš„è®¿é—®è·¯å¾„

1. **Supabase Dashboardè®¿é—®**
   - URL: https://supabase.com/dashboard/project/ojbocxqvufoblihkzijn/storage/buckets
   - ç‚¹å‡» "Storage" â†’ "Buckets" â†’ "monitor-screenshots"
   - å¯ä»¥ç›´æ¥åœ¨ç½‘é¡µä¸ŠæŸ¥çœ‹ã€ä¸‹è½½ã€åˆ é™¤æ–‡ä»¶

2. **å…¬å¼€è®¿é—®URLæ ¼å¼**
   ```
   https://ojbocxqvufoblihkzijn.supabase.co/storage/v1/object/public/monitor-screenshots/openrouter/latest.png
   ```

3. **åœ¨å‰ç«¯ä»£ç ä¸­è·å–URL**
   ```typescript
   const { data } = supabase.storage
     .from('monitor-screenshots')
     .getPublicUrl('openrouter/latest.png');
   
   console.log(data.publicUrl);
   ```

### æ–‡ä»¶ç®¡ç†ç­–ç•¥

- **æ¯å¤©è¦†ç›–å†™å…¥**ï¼šç›¸åŒè·¯å¾„ä¸Šä¼ ï¼Œè‡ªåŠ¨è¦†ç›–æ—§æ–‡ä»¶
- **å‘½åè§„åˆ™**ï¼š`{site_slug}/latest.png`
- **æ— éœ€æ¸…ç†æ—§æ–‡ä»¶**ï¼šå§‹ç»ˆä¿æŒæœ€æ–°ç‰ˆæœ¬

## ğŸ” æŠ€æœ¯æ ˆç¡®è®¤

### âœ… å·²ç¡®è®¤å¯ç”¨

1. **Supabase Edge Functions + Puppeteer**
   - âš ï¸ æ³¨æ„ï¼šSupabase Edge FunctionsåŸºäºDeno
   - âš ï¸ Puppeteeråœ¨Denoç¯å¢ƒä¸­æœ‰é™åˆ¶ï¼Œæ¨èä½¿ç”¨ `deno-puppeteer`
   - æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨ `Playwright` (æ›´å¥½æ”¯æŒDeno)

2. **Vercel Cron Jobs**
   - âœ… å…è´¹ç‰ˆæ”¯æŒ
   - âœ… å¯é…ç½®ä»»æ„cronè¡¨è¾¾å¼

3. **Supabase Storage**
   - âœ… å…è´¹é¢åº¦ï¼š1GB
   - âœ… æ”¯æŒå…¬å¼€è®¿é—®
   - âœ… è‡ªåŠ¨CDNåŠ é€Ÿ

### âš ï¸ éœ€è¦æ³¨æ„çš„é™åˆ¶

1. **Supabase Edge Functions**
   - è¶…æ—¶ï¼š90ç§’ï¼ˆè¶³å¤Ÿå•ä¸ªç½‘ç«™ï¼‰
   - å†…å­˜ï¼š512MB
   - å¹¶å‘ï¼šæœ‰é™åˆ¶ï¼Œå»ºè®®å•ä¸ªfunctionå¤„ç†å•ä¸ªç½‘ç«™

2. **æµè§ˆå™¨è‡ªåŠ¨åŒ–**
   - æ¨èä½¿ç”¨ `Playwright` for Deno
   - æˆ–ä½¿ç”¨æ— å¤´Chrome Dockerå®¹å™¨ï¼ˆéœ€è¦è‡ªå»ºæœåŠ¡ï¼‰

3. **å¤‡é€‰æ–¹æ¡ˆï¼šGitHub Actions**
   - å¦‚æœSupabase Edge Functionsæ— æ³•è¿è¡Œæµè§ˆå™¨
   - å¯ä»¥ç”¨GitHub Actions + Playwright
   - å®šæ—¶è§¦å‘ï¼Œç»“æœPOSTåˆ°Supabase

## ğŸ“ æœ¬åœ°ä»£ç ç®¡ç†

### ç›®å½•ç»“æ„

```
/keepup-v2/
â”œâ”€â”€ monitor-doc/              # æ‰€æœ‰è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ 01-æŠ€æœ¯æ¶æ„è®¾è®¡.md
â”‚   â”œâ”€â”€ 02-æ•°æ®åº“è®¾è®¡.md
â”‚   â”œâ”€â”€ 03-ç½‘ç«™é…ç½®YAML.md
â”‚   â”œâ”€â”€ 04-å‰ç«¯ç»„ä»¶è®¾è®¡.md
â”‚   â”œâ”€â”€ 05-æµ‹è¯•ç”¨ä¾‹.md
â”‚   â””â”€â”€ plan.md
â”œâ”€â”€ monitor-configs/          # ç½‘ç«™é…ç½®å¤‡ä»½
â”‚   â”œâ”€â”€ openrouter.yaml
â”‚   â”œâ”€â”€ tikhub.yaml
â”‚   â””â”€â”€ cursor.yaml
â”œâ”€â”€ supabase/
â”‚   â””â”€â”€ functions/
â”‚       â”œâ”€â”€ scrape-site/      # é€šç”¨æŠ“å–å™¨
â”‚       â”‚   â””â”€â”€ index.ts
â”‚       â””â”€â”€ scrape-all/       # æ‰¹é‡è§¦å‘å™¨
â”‚           â””â”€â”€ index.ts
â”œâ”€â”€ api/
â”‚   â””â”€â”€ cron/
â”‚       â””â”€â”€ scrape-monitor.ts # Vercel Cronåè°ƒå™¨
â””â”€â”€ src/
    â””â”€â”€ views/
        â””â”€â”€ MonitorView.vue   # ç›‘æ§é¡µé¢
```

### åŒæ­¥ç­–ç•¥

1. **é…ç½®æ–‡ä»¶**ï¼šæ•°æ®åº“ä¸­çš„YAMLé…ç½® = æœ¬åœ°YAMLæ–‡ä»¶
2. **Edge Functions**ï¼šéƒ¨ç½²åä¿ç•™æœ¬åœ°å‰¯æœ¬
3. **æ–‡æ¡£**ï¼šæ‰€æœ‰è®¾è®¡å†³ç­–éƒ½è®°å½•åœ¨monitor-doc/

## ğŸš€ éƒ¨ç½²æµç¨‹

### 1. æ•°æ®åº“åˆå§‹åŒ–
```bash
# é€šè¿‡MCPæ‰§è¡ŒSQL
åˆ›å»º3å¼ è¡¨ â†’ å¯¼å…¥Cookieæ•°æ® â†’ åˆ›å»ºStorage bucket
```

### 2. Edge Functionséƒ¨ç½²
```bash
supabase functions deploy scrape-site
supabase functions deploy scrape-all
```

### 3. å‰ç«¯éƒ¨ç½²
```bash
# æ·»åŠ ç¯å¢ƒå˜é‡åˆ°Vercel
npm run build
vercel deploy --prod
```

### 4. éªŒè¯æµ‹è¯•
- è®¿é—® /monitor é¡µé¢
- æ‰‹åŠ¨è§¦å‘å•ä¸ªç½‘ç«™æŠ“å–
- ç­‰å¾…å®šæ—¶ä»»åŠ¡æ‰§è¡Œï¼ˆæˆ–æ‰‹åŠ¨è°ƒç”¨cron endpointï¼‰

